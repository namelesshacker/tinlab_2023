<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_2.dtd'>
<nta>
	<declaration>// Place global declarations here.
// examples v1_12_06_2022 
// examples v1_13_06_2022 

// List one or more processes to be composed into a system.
//system schip,aanvoer,afvoer;
 
//system pomp,pompbediening;   
// for more uppaal documentation https://docs.uppaal.org/language-reference/expressions/

/** Requirementsoverzicht
 * Een sluis heeft deuren voor openenen en sluiten.
 * Een sluis heeft stoplichten met rood en groen waarmee toestemming al dann wel neit wordt gegeven voor schepen voor invaren of uitvaren.
 * Een schip heeft een positie en een doel
 * Een schip kan zich aanmelden
 * De pompbediening handelt de aanvraag van invarende, wachtende en uitvarende schepen af
 * Een schip kan in een wachtrij staan voodat hij een sluis invaart beneden.
 * Een schip kan in een wachtrij staan voodat hij een sluis invaart boven.
 * Een schip kan in een wachtrij staan voordat deze een sluis verlaat.
 * Als een sluis vol is komt een schip automatisch in een wachtrij.
 * Een sluis heeft een pomp(nivelleeersystseem) voor  hoog, midden, laag.
 * Een sluis houdt bij hoeveel schepen invaren.
 * Een sluis houdt bij wat de waterstand is.
 *
 * Scenario
 * Vanuit idle wordt er een schip toegevoegd aan de wachtrij boven of beneden. De sluis blijft in de wacthmodus totdat de wachtrij boven of beneden vol is.
 * Error handling
 * Pomp
 * Een pomp mag niet meer water bijpompen dan het maximum.
 * Een pomp mag niet meer  water wegpompen dan onder het NAP\
 * Stoplicht
 * Er mag niets mis gaan emt de stoplichten anders kunnen er botsingen voorkomen
 * Deur
 * Een deur moet binnen 30 seconden open en dicht anders wordt er een foutmelding gestuurd.
*/


chan start;

clock realtime;
//bool entrance_schip,schip_boven=true,schip_beneden=false;
bool direction = 0;
//bool process_started = false;
//bool process_finished = false;
//bool on=false, off=false;
//const int deuren = 2;
//typedef int[0,deuren-1] deur;
//bool gate_is_open[deur];
//int countCycle=0;


chan initOpenProc,initClosingProc;

//bool togglePomp = false;
//bool startDown =false;
//bool startUp= true;
bool position=0;




bool sluisToggle = false;
bool sluisIsBezig = false;
//bool lockOpen = false;
//int[-1,6] waterniveau = 0;




//typedef int[0,10] meter;
//meter waterlevel;
int[-10,10] waterlevel=0;


// identifier voor schepen
const int MAX_schepen=2;
typedef int[0,MAX_schepen-1] kenteken;
chan schipklik[kenteken];
chan register[kenteken];
chan unregister[kenteken];
//chan send[0,1],receive[0,1];

chan notified_pomp_direction;


// identifier voor wachtrij
// aantal queues voor wachtrij beneden,  de wachtrij boven en  aantal schepen in de sluis
const int aantal_wachtrijen=3;

const int SIZE=3;
//queue_of_ships stack[SIZE];
//int myarray[3] := {stack[SIZE], stack[SIZE], stack[SIZE]};
//int wachtrij_beneden[SIZE];
//int stack[SIZE];
//int wachtrij_boven[SIZE];
//int[0, 2] myarray[stack[SIZE]];
//int queues[queue];


const int aantal_queues=1;
//typedef int[0, aantal_queues-1] queue;// goed
typedef int[0, aantal_queues-1] id_q; // ook goed
//typedef int[0, aantal_wachtrijen-1] que; // ook goed
//typedef int[0,aantal_wachtrijen-1] queue_of_ships; // ook goed
//int[-1,6] mystack[SIZE]; // size is minimaal -1 en max gelijk aan 6 ?? Is dit een fout in Uppaal waar me rekening mee moeten houden in geval van state explosion???
//int queues[que];



// identifier voor deuren
int[0,1] gatenr;
const int aantal_deuren=1;
typedef int[0, aantal_deuren] id_d;
//const int deuren = 2;
//typedef int[0,deuren-1] deur;
//bool deur_is_open[id_d];
//chan deur_openen[id_d];
//chan deur_sluiten[id_d];
//bool deur_is_gesloten[id_d];
//chan open_gate[id_d];
//chan close_gate[id_d];
chan deurklik[id_d];


// identifier voor stoplichten
// id=0 invaren beneden
// id=1 uitvaren beneden
// id=2 uitvaren boven
// id=3  invaren boven
const int aantal_stoplichten=2;
typedef int[0,aantal_stoplichten-1] stoplicht;
typedef int[0, aantal_stoplichten-1] id_s;
chan stoplichtklik[id_s];
//chan start_stoplicht_uitvaren[id_s];
//chan stop_stoplicht_uitvaren[id_s];
//chan start_stoplicht_invaren[id_s];
//chan stop_stoplicht_invaren[id_s];



// identifier voor sensoren
//const int aantal_sensoren=4;
//typedef int[0, aantal_sensoren-1] id_sensor;
//typedef int[0,SIZE_STACK-1] stack;
/**
*/


//const int pompen = 1;
//typedef int[0,pompen-1] pomp_id;
chan pomp_klik;
//chan boot_aanwezig;
//chan toggle_pomp[pomp_id];



//chan send[kenteken], receive[kenteken];

//const int positions=2;
//typedef int[0,positions-1] locatie;
//chan shipTrigger[locatie];
 clock x;
clock systemtime;
clock processtime;

//chan	done, ready, run, stop;</declaration>
	<template>
		<name>opening</name>
		<location id="id0" x="136" y="-340">
		</location>
		<location id="id1" x="136" y="-612">
		</location>
		<location id="id2" x="25" y="-340">
		</location>
		<location id="id3" x="-102" y="-340">
			<name x="-112" y="-374">OpeningLow</name>
		</location>
		<location id="id4" x="-646" y="-442">
		</location>
		<location id="id5" x="-646" y="-612">
		</location>
		<location id="id6" x="-646" y="-340">
		</location>
		<location id="id7" x="-510" y="-340">
		</location>
		<location id="id8" x="-408" y="-340">
			<name x="-425" y="-399">OpeningHigh</name>
		</location>
		<location id="id9" x="-238" y="-442">
		</location>
		<location id="id10" x="-646" y="-612">
		</location>
		<location id="id11" x="-646" y="-612">
		</location>
		<location id="id12" x="-238" y="-340">
		</location>
		<location id="id13" x="136" y="-442">
		</location>
		<location id="id14" x="-408" y="-612">
		</location>
		<location id="id15" x="-102" y="-612">
		</location>
		<init ref="id9"/>
		<transition>
			<source ref="id2"/>
			<target ref="id0"/>
			<label kind="select" x="43" y="-391">stoplichtnummer: id_s</label>
			<label kind="synchronisation" x="43" y="-357">stoplichtklik[position]!</label>
		</transition>
		<transition>
			<source ref="id15"/>
			<target ref="id9"/>
			<label kind="synchronisation" x="-221" y="-586">pomp_klik!</label>
			<label kind="assignment" x="-136" y="-501">sluisToggle=true</label>
			<label kind="comments" x="-170" y="-714">select:
guard
sync:
update:</label>
		</transition>
		<transition>
			<source ref="id1"/>
			<target ref="id15"/>
			<label kind="select" x="-51" y="-637">deur_id:id_d</label>
			<label kind="synchronisation" x="-84" y="-629">deurklik[position]!</label>
			<label kind="comments" x="-42" y="-714">select:
guard
sync:deurklik[deur_id]!
update:</label>
		</transition>
		<transition>
			<source ref="id14"/>
			<target ref="id9"/>
			<label kind="synchronisation" x="-357" y="-586">pomp_klik!</label>
			<label kind="assignment" x="-408" y="-493">sluisToggle=true</label>
			<label kind="comments" x="-409" y="-765">select:
guard
sync:
update:</label>
		</transition>
		<transition>
			<source ref="id11"/>
			<target ref="id14"/>
			<label kind="select" x="-603" y="-654">deur_id:id_d</label>
			<label kind="synchronisation" x="-628" y="-629">deurklik[position]!</label>
			<label kind="comments" x="-620" y="-731">select:
guard
sync: deurklik[deur_id]!
update:</label>
		</transition>
		<transition>
			<source ref="id10"/>
			<target ref="id11"/>
		</transition>
		<transition>
			<source ref="id13"/>
			<target ref="id1"/>
			<label kind="select" x="8" y="-578">shipid: kenteken</label>
			<label kind="synchronisation" x="0" y="-544">register[shipid]!</label>
			<label kind="comments" x="229" y="-561">select:
guard:position==1 &amp;&amp; systemtime&gt;0900
sync:schipklik[shipid]!
update:</label>
			<nail x="136" y="-476"/>
		</transition>
		<transition>
			<source ref="id0"/>
			<target ref="id13"/>
			<label kind="select" x="136" y="-442">shipid: kenteken</label>
			<label kind="synchronisation" x="136" y="-408">schipklik[shipid]!</label>
			<label kind="comments" x="246" y="-348">select:
guard
sync:open_gate[direction]!
update:</label>
		</transition>
		<transition>
			<source ref="id3"/>
			<target ref="id2"/>
			<label kind="synchronisation" x="-84" y="-357">stoplichtklik[position]!</label>
			<label kind="comments" x="17" y="-314">select:
guard
sync:deurklik[deur_id]!
update:</label>
		</transition>
		<transition>
			<source ref="id4"/>
			<target ref="id5"/>
			<label kind="select" x="-646" y="-578">shipid:kenteken</label>
			<label kind="synchronisation" x="-646" y="-544">register[shipid]!</label>
			<label kind="comments" x="-960" y="-663">select:
guard:position==0 &amp;&amp; systemtime&gt;0900
sync:schipklik[shipid]!
update:

select:
guard
sync:register[shipid]!
update:</label>
		</transition>
		<transition>
			<source ref="id6"/>
			<target ref="id4"/>
			<label kind="select" x="-646" y="-442">shipid: kenteken</label>
			<label kind="synchronisation" x="-646" y="-408">schipklik[shipid]!</label>
			<label kind="comments" x="-841" y="-425">select:
guard
sync: open_gate[direction]!
update:</label>
		</transition>
		<transition>
			<source ref="id7"/>
			<target ref="id6"/>
			<label kind="select" x="-578" y="-340">stoplichtnummer: id_s</label>
			<label kind="synchronisation" x="-595" y="-314">stoplichtklik[position]!</label>
			<label kind="comments" x="-790" y="-238">select:
guard:systemtime &lt;0900
sync:stoplichtklik[stoplichtnummer]!
update:</label>
		</transition>
		<transition>
			<source ref="id8"/>
			<target ref="id7"/>
			<label kind="synchronisation" x="-492" y="-357">stoplichtklik[position]!</label>
			<label kind="comments" x="-552" y="-246">select:deur_id:id_d
guard
sync:deurklik[deur_id]!
update:</label>
		</transition>
		<transition>
			<source ref="id10"/>
			<target ref="id5"/>
		</transition>
		<transition>
			<source ref="id5"/>
			<target ref="id10"/>
		</transition>
		<transition>
			<source ref="id10"/>
			<target ref="id5"/>
		</transition>
		<transition>
			<source ref="id5"/>
			<target ref="id10"/>
		</transition>
		<transition>
			<source ref="id10"/>
			<target ref="id5"/>
		</transition>
		<transition>
			<source ref="id5"/>
			<target ref="id10"/>
		</transition>
		<transition>
			<source ref="id11"/>
			<target ref="id10"/>
		</transition>
		<transition>
			<source ref="id5"/>
			<target ref="id11"/>
		</transition>
		<transition>
			<source ref="id11"/>
			<target ref="id5"/>
		</transition>
		<transition>
			<source ref="id5"/>
			<target ref="id11"/>
		</transition>
		<transition>
			<source ref="id11"/>
			<target ref="id5"/>
		</transition>
		<transition>
			<source ref="id10"/>
			<target ref="id11"/>
		</transition>
		<transition>
			<source ref="id9"/>
			<target ref="id12"/>
			<label kind="synchronisation" x="-238" y="-408">initOpenProc?</label>
		</transition>
		<transition>
			<source ref="id12"/>
			<target ref="id3"/>
			<label kind="select" x="-229" y="-365">deurnummer: id_d</label>
			<label kind="guard" x="-229" y="-340">position==1&amp;&amp; systemtime &gt;08</label>
			<label kind="synchronisation" x="-203" y="-357">deurklik[position]!</label>
			<label kind="comments" x="-212" y="-246">select:
guard:systemtime &gt;1245&amp;&amp; systemtime &lt;2100
sync:
update:</label>
			<nail x="-221" y="-340"/>
		</transition>
		<transition>
			<source ref="id12"/>
			<target ref="id8"/>
			<label kind="select" x="-382" y="-314">deurnummer: id_d</label>
			<label kind="guard" x="-390" y="-374">position==0 &amp;&amp; systemtime &gt;08</label>
			<label kind="synchronisation" x="-390" y="-357">deurklik[position]!</label>
			<label kind="comments" x="-391" y="-255">select:
guard: systemtime &gt;0845
sync:
update:</label>
		</transition>
	</template>
	<template>
		<name>closing</name>
		<location id="id16" x="-54418" y="-187">
		</location>
		<location id="id17" x="-54307" y="-187">
		</location>
		<location id="id18" x="-54307" y="-459">
		</location>
		<location id="id19" x="-54545" y="-187">
			<name x="-54555" y="-221">ClosingLow</name>
		</location>
		<location id="id20" x="-55089" y="-289">
		</location>
		<location id="id21" x="-55089" y="-459">
		</location>
		<location id="id22" x="-55089" y="-187">
		</location>
		<location id="id23" x="-54953" y="-187">
		</location>
		<location id="id24" x="-54851" y="-187">
			<name x="-54868" y="-246">ClosingHigh</name>
		</location>
		<location id="id25" x="-54681" y="-289">
		</location>
		<location id="id26" x="-55089" y="-459">
		</location>
		<location id="id27" x="-55089" y="-459">
		</location>
		<location id="id28" x="-54681" y="-187">
		</location>
		<location id="id29" x="-54307" y="-289">
		</location>
		<location id="id30" x="-54851" y="-459">
		</location>
		<location id="id31" x="-54545" y="-459">
		</location>
		<init ref="id25"/>
		<transition>
			<source ref="id16"/>
			<target ref="id17"/>
			<label kind="select" x="-54400" y="-238">stoplichtnummer: id_s</label>
			<label kind="synchronisation" x="-54400" y="-204">stoplichtklik[direction]!</label>
		</transition>
		<transition>
			<source ref="id31"/>
			<target ref="id25"/>
			<label kind="synchronisation" x="-54664" y="-433">pomp_klik!</label>
			<label kind="assignment" x="-54579" y="-348">sluisToggle=true</label>
			<label kind="comments" x="-54613" y="-561">select:
guard
sync:
update:</label>
		</transition>
		<transition>
			<source ref="id18"/>
			<target ref="id31"/>
			<label kind="select" x="-54494" y="-484">deur_id:id_d</label>
			<label kind="synchronisation" x="-54527" y="-476">deurklik[direction]!</label>
			<label kind="comments" x="-54485" y="-561">select:
guard
sync:deurklik[deur_id]!
update:</label>
		</transition>
		<transition>
			<source ref="id30"/>
			<target ref="id25"/>
			<label kind="synchronisation" x="-54800" y="-433">pomp_klik!</label>
			<label kind="assignment" x="-54851" y="-340">sluisToggle=true</label>
			<label kind="comments" x="-54852" y="-612">select:
guard
sync:
update:</label>
		</transition>
		<transition>
			<source ref="id27"/>
			<target ref="id30"/>
			<label kind="select" x="-55046" y="-501">deur_id:id_d</label>
			<label kind="synchronisation" x="-55071" y="-476">deurklik[direction]!</label>
			<label kind="comments" x="-55063" y="-578">select:
guard
sync: deurklik[deur_id]!
update:</label>
		</transition>
		<transition>
			<source ref="id26"/>
			<target ref="id27"/>
		</transition>
		<transition>
			<source ref="id29"/>
			<target ref="id18"/>
			<label kind="select" x="-54435" y="-425">shipid: kenteken</label>
			<label kind="synchronisation" x="-54443" y="-391">unregister[shipid]!</label>
			<label kind="comments" x="-54214" y="-408">select:
guard:position==1 &amp;&amp; systemtime&gt;0900
sync:schipklik[shipid]!
update:</label>
			<nail x="-54307" y="-323"/>
		</transition>
		<transition>
			<source ref="id17"/>
			<target ref="id29"/>
			<label kind="select" x="-54307" y="-289">shipid: kenteken</label>
			<label kind="synchronisation" x="-54307" y="-255">schipklik[shipid]!</label>
			<label kind="comments" x="-54197" y="-195">select:
guard
sync:open_gate[direction]!
update:</label>
		</transition>
		<transition>
			<source ref="id19"/>
			<target ref="id16"/>
			<label kind="synchronisation" x="-54527" y="-204">stoplichtklik[direction]!</label>
			<label kind="comments" x="-54426" y="-161">select:
guard
sync:deurklik[deur_id]!
update:</label>
		</transition>
		<transition>
			<source ref="id20"/>
			<target ref="id21"/>
			<label kind="select" x="-55089" y="-425">shipid:kenteken</label>
			<label kind="synchronisation" x="-55089" y="-391">unregister[shipid]!</label>
			<label kind="comments" x="-55403" y="-510">select:
guard:position==0 &amp;&amp; systemtime&gt;0900
sync:schipklik[shipid]!
update:

select:
guard
sync:register[shipid]!
update:</label>
		</transition>
		<transition>
			<source ref="id22"/>
			<target ref="id20"/>
			<label kind="select" x="-55089" y="-289">shipid: kenteken</label>
			<label kind="synchronisation" x="-55089" y="-255">schipklik[shipid]!</label>
			<label kind="comments" x="-55284" y="-272">select:
guard
sync: open_gate[direction]!
update:</label>
		</transition>
		<transition>
			<source ref="id23"/>
			<target ref="id22"/>
			<label kind="select" x="-55021" y="-187">stoplichtnummer: id_s</label>
			<label kind="synchronisation" x="-55038" y="-161">stoplichtklik[direction]!</label>
			<label kind="comments" x="-55233" y="-85">select:
guard:systemtime &lt;0900
sync:stoplichtklik[stoplichtnummer]!
update:</label>
		</transition>
		<transition>
			<source ref="id24"/>
			<target ref="id23"/>
			<label kind="synchronisation" x="-54935" y="-204">stoplichtklik[direction]!</label>
			<label kind="comments" x="-54995" y="-93">select:deur_id:id_d
guard
sync:deurklik[deur_id]!
update:</label>
		</transition>
		<transition>
			<source ref="id26"/>
			<target ref="id21"/>
		</transition>
		<transition>
			<source ref="id21"/>
			<target ref="id26"/>
		</transition>
		<transition>
			<source ref="id26"/>
			<target ref="id21"/>
		</transition>
		<transition>
			<source ref="id21"/>
			<target ref="id26"/>
		</transition>
		<transition>
			<source ref="id26"/>
			<target ref="id21"/>
		</transition>
		<transition>
			<source ref="id21"/>
			<target ref="id26"/>
		</transition>
		<transition>
			<source ref="id27"/>
			<target ref="id26"/>
		</transition>
		<transition>
			<source ref="id21"/>
			<target ref="id27"/>
		</transition>
		<transition>
			<source ref="id27"/>
			<target ref="id21"/>
		</transition>
		<transition>
			<source ref="id21"/>
			<target ref="id27"/>
		</transition>
		<transition>
			<source ref="id27"/>
			<target ref="id21"/>
		</transition>
		<transition>
			<source ref="id26"/>
			<target ref="id27"/>
		</transition>
		<transition>
			<source ref="id25"/>
			<target ref="id28"/>
			<label kind="synchronisation" x="-54681" y="-255">initClosingProc?</label>
		</transition>
		<transition>
			<source ref="id28"/>
			<target ref="id19"/>
			<label kind="select" x="-54672" y="-212">deurnummer: id_d</label>
			<label kind="guard" x="-54672" y="-187">position==1&amp;&amp; systemtime &gt;08</label>
			<label kind="synchronisation" x="-54646" y="-204">deurklik[direction]!</label>
			<label kind="assignment" x="-54646" y="-187">position=!position,sluisToggle=false</label>
			<label kind="comments" x="-54655" y="-93">select:
guard:systemtime &gt;1245&amp;&amp; systemtime &lt;2100
sync:
update:</label>
			<nail x="-54664" y="-187"/>
		</transition>
		<transition>
			<source ref="id28"/>
			<target ref="id24"/>
			<label kind="select" x="-54825" y="-161">deurnummer: id_d</label>
			<label kind="guard" x="-54833" y="-221">position==0 &amp;&amp; systemtime &gt;08</label>
			<label kind="synchronisation" x="-54833" y="-204">deurklik[direction]!</label>
			<label kind="assignment" x="-54833" y="-187">position=!position,sluisToggle=false</label>
			<label kind="comments" x="-54834" y="-102">select:
guard: systemtime &gt;0845
sync:
update:</label>
		</transition>
	</template>
	<template>
		<name>maincontroller</name>
		<declaration>
/**
 * Requirements
 * Voordat het template de states stoplicht en deur heeft bereikt is de richting van het schip bekend en tegengesteld aan de huidige positie.
 * In de idle stand is het mogeljk dat de clocktijd niet gelijk is aan nul, omdat het systeem alleen op 120 tijdseenheden en 
 * Een pomp is actief als er nul of 1 of 2 schepen in de sluis zitten.
 * De sluis heeft een trigger waarmee een actie kan worden gestart met een preconditie gerelateerd aan 1 van de volgende tenplates:schip,stoplicht,systeemtime,pomp,deur.
 *
 *
*/

/**
clock systemtime;
int  thresholdUp = 0900;
int thresholdDown=1300;





bool waterlockStartPosition()
{

    return false;
}

*/



// een schip kan zich anamelden bij de sluis(control system); een machine; deze voert bewerkingen uit op de omgeving met informatie van de beheerder
// de sluis bedient de waterpomp,sluisdeur,stoplicht,aanvoer en afvoer van schepen

/** stack
 * de lengte van de datastructuur
*/
//const int time_step = 2;




/**
 *
*/
//int[0,SIZE] head =0;

/** pop
 *
*/

/**
kenteken pop_left()
{
    kenteken temp;
    //temp=stack[--head]; // neem de head voordat we de waarde uitlezen
    //stack[head]=0; // verwijder de waarde
    return temp;
    
}
*/
/**
kenteken pop_center()
{
    kenteken temp;
    //temp=stack[--head]; // neem de head voordat we de waarde uitlezen
    //stack[head]=0; // verwijder de waarde
    return temp;
    
}
*/
/**
kenteken pop_right()
{
    kenteken temp;
    //temp=stack[--head]; // neem de head voordat we de waarde uitlezen
    //stack[head]=0; // verwijder de waarde
    return temp;
    
}
*/

/** push
 *
*/
/**
void push(kenteken p)
{
    //stack[head++]=p;
}
*/

/** isFull
 *
*/
/**
bool isFull()
{
    return (head==SIZE);
}
*/

/** isEmpty
 *
*/

/**
bool isEmpty()
{
 return (head ==0);
}
*/

/**
void reset()
{}

*/</declaration>
		<location id="id32" x="340" y="-374">
			<name x="255" y="-416">startCycle</name>
		</location>
		<location id="id33" x="952" y="-374">
			<name x="977" y="-459">WatermonitoringOn</name>
		</location>
		<location id="id34" x="204" y="-374">
			<name x="194" y="-408">idle</name>
		</location>
		<location id="id35" x="544" y="-230">
		</location>
		<location id="id36" x="646" y="-374">
			<name x="636" y="-408">posTaken</name>
		</location>
		<location id="id37" x="442" y="-374">
			<name x="432" y="-408">positioning</name>
		</location>
		<location id="id38" x="544" y="-510">
			<name x="534" y="-544">DefaultHigh</name>
		</location>
		<location id="id39" x="714" y="-374">
			<name x="704" y="-408">procStart</name>
		</location>
		<location id="id40" x="850" y="-374">
			<name x="840" y="-408">free_all</name>
		</location>
		<location id="id41" x="782" y="-374">
			<name x="773" y="-408">procEnd</name>
		</location>
		<location id="id42" x="901" y="-374">
			<name x="891" y="-408">end_cycle</name>
		</location>
		<location id="id43" x="714" y="-204">
			<name x="704" y="-238">running</name>
		</location>
		<location id="id44" x="850" y="-204">
			<name x="840" y="-238">finished</name>
		</location>
		<init ref="id34"/>
		<transition>
			<source ref="id40"/>
			<target ref="id42"/>
		</transition>
		<transition>
			<source ref="id44"/>
			<target ref="id41"/>
			<label kind="synchronisation" x="800" y="-289">initClosingProc!</label>
			<nail x="850" y="-272"/>
			<nail x="782" y="-272"/>
		</transition>
		<transition>
			<source ref="id39"/>
			<target ref="id43"/>
			<label kind="synchronisation" x="714" y="-306">initOpenProc!</label>
			<label kind="comments" x="561" y="-306">select:
guard:  
sync:initOpenProc!
update:</label>
		</transition>
		<transition>
			<source ref="id42"/>
			<target ref="id33"/>
		</transition>
		<transition>
			<source ref="id32"/>
			<target ref="id37"/>
		</transition>
		<transition>
			<source ref="id41"/>
			<target ref="id40"/>
			<label kind="comments" x="782" y="-535">select:
guard:  
sync:initClosingProc!
update:</label>
		</transition>
		<transition>
			<source ref="id36"/>
			<target ref="id39"/>
		</transition>
		<transition>
			<source ref="id34"/>
			<target ref="id32"/>
			<nail x="297" y="-374"/>
		</transition>
		<transition>
			<source ref="id33"/>
			<target ref="id32"/>
			<label kind="assignment" x="358" y="-646">systemtime=0</label>
			<nail x="952" y="-484"/>
			<nail x="952" y="-646"/>
			<nail x="340" y="-646"/>
		</transition>
		<transition>
			<source ref="id35"/>
			<target ref="id36"/>
		</transition>
		<transition>
			<source ref="id37"/>
			<target ref="id35"/>
			<label kind="assignment" x="460" y="-323">direction=1</label>
		</transition>
		<transition>
			<source ref="id38"/>
			<target ref="id36"/>
		</transition>
		<transition>
			<source ref="id37"/>
			<target ref="id38"/>
			<label kind="assignment" x="460" y="-442">direction=0</label>
		</transition>
		<transition>
			<source ref="id43"/>
			<target ref="id44"/>
			<label kind="comments" x="986" y="-408">select:
guard: (position==1 &amp;&amp; waterlevel==0) || (position==0 &amp;&amp; waterlevel==10)
sync:
update:</label>
			<nail x="756" y="-204"/>
			<nail x="782" y="-204"/>
			<nail x="816" y="-204"/>
		</transition>
	</template>
	<template>
		<name>Error</name>
		<location id="id45" x="0" y="0">
			<name x="-10" y="-34">idle</name>
		</location>
		<location id="id46" x="136" y="0">
			<name x="126" y="-34">check</name>
		</location>
		<location id="id47" x="272" y="0">
			<name x="262" y="-34">fixed</name>
		</location>
		<location id="id48" x="272" y="-102">
			<name x="262" y="-136">ready</name>
		</location>
		<init ref="id45"/>
		<transition>
			<source ref="id48"/>
			<target ref="id45"/>
			<nail x="0" y="-102"/>
		</transition>
		<transition>
			<source ref="id47"/>
			<target ref="id48"/>
		</transition>
		<transition>
			<source ref="id46"/>
			<target ref="id45"/>
			<nail x="136" y="102"/>
			<nail x="0" y="102"/>
		</transition>
		<transition>
			<source ref="id46"/>
			<target ref="id47"/>
		</transition>
		<transition>
			<source ref="id45"/>
			<target ref="id46"/>
		</transition>
	</template>
	<template>
		<name>deur</name>
		<parameter>id_d d</parameter>
		<declaration>
/**
 * Requirements
 * Een deur is tijdens een actieve pomp altijd gesloten
 * Een deur kan nooit open staan terwijl het stoplicht voor invaren/uitvaren op rood staat.
 * Een deur wordt altijd getriggerd vanuit de maincontroller en kan dus oneindig wachten totdat de maincontroller een opdracht geeft.
 * Een deur kan nooit in een oneindige tussenstand staan zoals: is bezig met openen of is bezig met sluiten.
 *
 *
*/
// parameter: const gatenr gatenummer
clock x;
//int[0,1] currentstate;</declaration>
		<location id="id49" x="0" y="0">
			<name x="-17" y="8">closed</name>
		</location>
		<location id="id50" x="0" y="-204">
			<name x="-10" y="-238">opening</name>
		</location>
		<init ref="id49"/>
		<transition>
			<source ref="id50"/>
			<target ref="id49"/>
			<label kind="synchronisation" x="102" y="-161">deurklik[d]?</label>
			<nail x="68" y="-170"/>
			<nail x="68" y="-34"/>
		</transition>
		<transition>
			<source ref="id49"/>
			<target ref="id50"/>
			<label kind="synchronisation" x="-178" y="-153">deurklik[d]?</label>
			<nail x="-68" y="-34"/>
			<nail x="-68" y="-170"/>
		</transition>
	</template>
	<template>
		<name>schip</name>
		<parameter>kenteken id</parameter>
		<declaration>

/**
 * Requirements
 * Een schip kan maar 1 id/kenteken hebben en dit kenteken komt maar 1 keer in  de cyclus voor, inclusief de beide wachtrijen en de queue van de sluiskolk.
 * Een schip kan in de sluiskolk niet van richting veranderen
 * Een schip kan na het doorlopen van de cycli en uitgevaren zijn van de sluis een willekeurige andere positie en richting hebben aangenomen.
 *
 *
 *
*/
// const kenteken schipid
//int positie =0;
//bool myDirection = false;
clock x;

</declaration>
		<location id="id51" x="0" y="-102">
			<name x="-10" y="-136">ildle</name>
		</location>
		<location id="id52" x="0" y="51">
			<name x="-10" y="17">varen</name>
		</location>
		<init ref="id51"/>
		<transition>
			<source ref="id52"/>
			<target ref="id51"/>
			<label kind="guard" x="26" y="17">x&gt;5</label>
			<nail x="8" y="51"/>
			<nail x="170" y="51"/>
			<nail x="170" y="-102"/>
		</transition>
		<transition>
			<source ref="id51"/>
			<target ref="id52"/>
			<label kind="select" x="0" y="-76">shipid: kenteken</label>
			<label kind="synchronisation" x="0" y="-42">schipklik[shipid]?</label>
			<label kind="comments" x="-187" y="-76">sync:
send[kenteken]


update:
positie: int[0,1]</label>
		</transition>
	</template>
	<template>
		<name>pomp</name>
		<location id="id53" x="-714" y="34">
			<name x="-724" y="0">pomp_uit</name>
			<label kind="comments" x="-1334" y="127">ipv aan en uit states kan er ook gekozen worden voor de states laag en hoog</label>
		</location>
		<location id="id54" x="-612" y="170">
			<name x="-622" y="136">idle</name>
		</location>
		<init ref="id53"/>
		<transition>
			<source ref="id54"/>
			<target ref="id54"/>
			<label kind="guard" x="-731" y="204">sluisToggle==false &amp;&amp; position==0 &amp;&amp; waterlevel&lt;10</label>
			<label kind="assignment" x="-612" y="221">waterlevel++</label>
			<label kind="comments" x="-824" y="229">select:
guard: 
sync:
update: waterlevel++</label>
			<nail x="-612" y="272"/>
			<nail x="-578" y="272"/>
		</transition>
		<transition>
			<source ref="id54"/>
			<target ref="id54"/>
			<label kind="guard" x="-594" y="136">position==1 &amp;&amp; waterlevel&gt;-10</label>
			<label kind="assignment" x="-594" y="170">waterlevel--</label>
			<label kind="comments" x="-527" y="-50">select:
guard:position==1 &amp;&amp; waterlevel&gt;-10
sync:
update:waterlevel--</label>
			<nail x="-510" y="170"/>
			<nail x="-510" y="204"/>
		</transition>
		<transition>
			<source ref="id54"/>
			<target ref="id53"/>
			<label kind="synchronisation" x="-696" y="153">pomp_klik?</label>
			<nail x="-714" y="170"/>
		</transition>
		<transition>
			<source ref="id53"/>
			<target ref="id54"/>
			<label kind="synchronisation" x="-662" y="17">pomp_klik?</label>
			<nail x="-680" y="34"/>
			<nail x="-612" y="34"/>
		</transition>
	</template>
	<template>
		<name>sluis</name>
		<parameter>id_q q</parameter>
		<declaration>
/**
 * Requirements
 * Een wachtrij kan maximaal 2 schepen bevatten.
 * Een aanvarend schip kan maximaal 1 cyclus in de wachtrij staan.
 *
 *
 *
 *
*/

/**
 * Requirements
 * Er kunnen maximaal 2 schepen in de sluis.
 * De kentekens van schepen in de sluis is nooit gelijk aan een kenteken van een schip in een wachtrij.
 *
 *
 *
 *
*/
const int N = 4;          //
clock x;
kenteken list[N+1];
int[0,N] len;



// parameter: const stack  q

bool is_full()
{
    return false;
}


void dequeues()
{
    int i = 0;
        len -= 1;
        while (i &lt; len)
        {
                list[i] = list[i + 1];
                i++;
        }
        list[i] = 0;
}


void enqueue(kenteken element)
{
     list[element] = element;
}
void dequeue(kenteken element)
{
     list[element] = 0;
}
bool is_empty()
{
    return false;
}

bool go_out()
{
    return false;
}


bool lock_empty()
{
    return false;
}

/*
// Returns the front element of the queue
id_t frontElement()
{
     return list[len - 1];
}

// Returns the last element of the queue
id_t tail()
{
   return list[len - 1];
}
*/

chan lock_full;

chan to_lock;
//chan go_out;</declaration>
		<location id="id55" x="0" y="0">
			<name x="-10" y="-34">idle</name>
		</location>
		<location id="id56" x="119" y="0">
			<name x="109" y="-34">add</name>
		</location>
		<location id="id57" x="238" y="0">
			<name x="228" y="-34">release</name>
		</location>
		<init ref="id55"/>
		<transition>
			<source ref="id57"/>
			<target ref="id55"/>
			<nail x="238" y="25"/>
			<nail x="238" y="102"/>
			<nail x="0" y="102"/>
		</transition>
		<transition>
			<source ref="id56"/>
			<target ref="id57"/>
			<label kind="select" x="154" y="-51">shipid: kenteken</label>
			<label kind="synchronisation" x="154" y="-17">unregister[shipid]?</label>
			<label kind="assignment" x="154" y="0">dequeue(shipid)</label>
			<nail x="136" y="0"/>
		</transition>
		<transition>
			<source ref="id55"/>
			<target ref="id56"/>
			<label kind="select" x="52" y="-51">shipid: kenteken</label>
			<label kind="synchronisation" x="52" y="-17">register[shipid]?</label>
			<label kind="assignment" x="52" y="0">enqueue(shipid)</label>
			<label kind="comments" x="52" y="25">select:
guard:position==0 &amp;&amp; systemtime&gt;0900
sync:schipklik[shipid]!
update:enqueue(shipid)</label>
			<nail x="34" y="0"/>
		</transition>
	</template>
	<template>
		<name>stoplight</name>
		<parameter>id_s s</parameter>
		<declaration>
/**
 * Requirements
 * Een stoplicht is tijdens een actieve pomp altijd op rood.
 * Een invaar- en uitvaarstoplicht kunnen niet beiden op groen staan, omdat er dan een botsing kan voorkomen.
 * Een invaar- en uitvaarstoplicht kunnen beiden op rood staan.
 *
 *
 *
*/

// stoplicht 0
// stoplicht 1
// stoplicht 2
// stoplicht 3
clock timer;</declaration>
		<location id="id58" x="0" y="0">
			<name x="-10" y="-34">rood</name>
		</location>
		<location id="id59" x="272" y="0">
			<name x="262" y="-34">groen</name>
		</location>
		<init ref="id58"/>
		<transition>
			<source ref="id58"/>
			<target ref="id59"/>
			<label kind="synchronisation" x="93" y="-42">stoplichtklik[s]?</label>
			<nail x="34" y="0"/>
			<nail x="170" y="0"/>
		</transition>
		<transition>
			<source ref="id59"/>
			<target ref="id58"/>
			<label kind="synchronisation" x="18" y="119">stoplichtklik[s]?</label>
			<nail x="272" y="136"/>
			<nail x="0" y="136"/>
		</transition>
	</template>
	<system>// Place template instantiations here.
//Process = Template();
// List one or more processes to be composed into a system.
system maincontroller,deur,pomp,sluis,schip,stoplight,opening,closing;
//system maincontroller,deur,pomp,sluis,schip,stoplight,OpeningProc,ClosingProc;
//system newmain,newmainOpeningProc,request,priorityQueue,priorityQueue,newmainClosingProc,sensorLow,sensorHigh,waterlevelSensorLow,waterlevelSensorHigh,newpomp,newdeur,sluis;</system>
	<queries>
		<query>
			<formula>A[] not deadlock</formula>
			<comment></comment>
		</query>
		<query>
			<formula>A[] Queue.list[N-1]==0</formula>
			<comment></comment>
		</query>
		<query>
			<formula>A[] deur</formula>
			<comment>Hoe lang blijft deur open</comment>
		</query>
		<query>
			<formula>A[] deur</formula>
			<comment>hoelang duurt openen</comment>
		</query>
		<query>
			<formula>A[] deur</formula>
			<comment>Hoelang duurt sluiten van een deur</comment>
		</query>
		<query>
			<formula>A[] stoplight</formula>
			<comment>Hooelang blijft stoplicht op groen</comment>
		</query>
		<query>
			<formula>A[] stoplight</formula>
			<comment>Hoelang duurt van rood naar groen</comment>
		</query>
		<query>
			<formula>A[] stoplight</formula>
			<comment>Hoelang duurt van groen naar rood</comment>
		</query>
		<query>
			<formula>A[] schip</formula>
			<comment>Hoe snel vaart schip in</comment>
		</query>
		<query>
			<formula>A[] schip</formula>
			<comment>Hoe lang blijft schip in sluis</comment>
		</query>
		<query>
			<formula>A[] schip</formula>
			<comment>Hoe sne vaart schip uit de sluis?</comment>
		</query>
		<query>
			<formula>A[] pomp</formula>
			<comment>Hoe lang duurt pomp aanzetten</comment>
		</query>
		<query>
			<formula>A[] pomp</formula>
			<comment>Hoelang blijft pomp bezig</comment>
		</query>
		<query>
			<formula>A[] pomp</formula>
			<comment>Hoe snel gaat pomp uit</comment>
		</query>
	</queries>
</nta>
